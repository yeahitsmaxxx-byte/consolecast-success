<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ConsoleCast Receiver</title>
  <style>
    body {
      margin:0;
      font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif;
      background:#0b0b0f;
      color:#fff;
      overflow:hidden;
    }
    #toastContainer {
      position:fixed;
      top:20px;
      right:20px;
      display:flex;
      flex-direction:column;
      gap:10px;
      z-index:9999;
    }
    .toast {
      display:flex;
      align-items:center;
      gap:10px;
      width:380px;
      min-height:80px;
      background:rgba(20,20,20,0.9);
      border-radius:10px;
      padding:10px 14px;
      color:#fff;
      box-shadow:0 4px 20px rgba(0,0,0,.35);
      animation:slideIn .25s ease-out, fadeOut .25s ease-in 5s forwards;
    }
    .toast .icon img {
      width:32px;
      height:32px;
      border-radius:6px;
    }
    .toast .content { flex:1; }
    .toast .title {
      font-weight:700;
      font-size:1rem;
      margin-bottom:2px;
    }
    .toast .msg {
      opacity:0.85;
      font-size:0.9rem;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    /* Color accents */
    .toast.whatsapp { border-left:4px solid #25D366; }
    .toast.snapchat { border-left:4px solid #FFFC00; background:#fff; color:#000; }
    .toast.twitter  { border-left:4px solid #1DA1F2; }
    .toast.default  { border-left:4px solid #aaa; }
    /* Animations */
    @keyframes slideIn { from{opacity:0; transform:translateX(40px);} to{opacity:1; transform:translateX(0);} }
    @keyframes fadeOut { to{opacity:0; transform:translateX(40px);} }
    /* Watermark for Free plan */
    #watermark {
      position:fixed; bottom:10px; right:10px;
      font-size:0.8rem; opacity:0.6; color:#fff;
    }
  </style>
</head>
<body>
  <div id="toastContainer"></div>
  <div id="watermark">ConsoleCast Free</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
  import { getDatabase, ref, query, limitToLast, onChildAdded } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-database.js";

  // === Your Firebase config ===
  const firebaseConfig = {
    apiKey: "AIzaSyBGiPQRlT7xVWPp1rhOGUGekkFutOCEe4",
    authDomain: "consolecast-7aa94.firebaseapp.com",
    databaseURL: "https://consolecast-7aa94-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "consolecast-7aa94",
    storageBucket: "consolecast-7aa94.appspot.com",
    messagingSenderId: "491737021551",
    appId: "1:491737021551:web:18e4c7f73a117e115e19a"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  // Get room + key from URL
  const params = new URLSearchParams(location.search);
  const ROOM = params.get("room") || "default";
  const KEY  = params.get("key") || null;

  // Free mode daily limit
  let freeCount = 0;
  const FREE_LIMIT = 20;

  const toastContainer = document.getElementById("toastContainer");
  const watermark = document.getElementById("watermark");

  function showToast(data){
    // Free plan cap
    if(!KEY){
      freeCount++;
      if(freeCount > FREE_LIMIT){
        if(freeCount === FREE_LIMIT+1) alert("Free plan daily limit reached");
        return;
      }
    }

    const sender = (data.sender||"").toLowerCase();
    let cls = "default";
    if(sender.includes("whatsapp")) cls="whatsapp";
    else if(sender.includes("snap")) cls="snapchat";
    else if(sender.includes("twitter")) cls="twitter";

    const toast = document.createElement("div");
    toast.className = `toast ${cls}`;
    toast.innerHTML = `
      <div class="icon"><img src="icons/${cls}.png" onerror="this.src='icons/default.png'"></div>
      <div class="content">
        <div class="title">${data.sender||"Unknown"}</div>
        <div class="msg">${data.message||""}</div>
      </div>`;
    toastContainer.appendChild(toast);

    // Auto-remove after 5s
    setTimeout(()=>toast.remove(),5200);
  }

  // Listen for new messages
  const q = query(ref(db, `rooms/${ROOM}/messages`), limitToLast(50));
  onChildAdded(q, snap=>{
    showToast(snap.val());
  });

  // Hide watermark if Pro/Elite
  if(KEY) watermark.style.display="none";

</script>
</body>
</html>
